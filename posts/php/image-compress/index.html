<!doctype html><html lang=en x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>PHP å¯¹ PNGã€JPGã€JPEGã€GIFã€WebP ç­‰æ ¼å¼å›¾ç‰‡è¿›è¡Œå‹ç¼© | sqrtcat çš„åšå®¢</title>
<link href=/favicon.ico rel="shortcut icon" type=image/x-icon><meta name=author content="sqrtcat"><meta name=description content="åŸç”Ÿ PHP å¯¹ PNGã€JPGã€JPEGã€GIFã€WebP ç­‰å¸¸ç”¨å›¾ç‰‡æ ¼å¼è¿›è¡Œå‹ç¼©ï¼Œæ— ç¬¬ä¸‰æ–¹æ‰©å±•ä¾èµ–ï¼Œä»…éœ€ç®€å•é…ç½®å³å¯ä½¿ç”¨ï¼Œæ”¯æŒ PNG é€æ˜èƒŒæ™¯ã€‚
"><link rel=canonical href=https://sqrt-cat.github.io/posts/php/image-compress/><meta property="og:url" content="https://sqrt-cat.github.io/posts/php/image-compress/"><meta property="og:site_name" content="sqrtcat çš„åšå®¢"><meta property="og:title" content="PHP å¯¹ PNGã€JPGã€JPEGã€GIFã€WebP ç­‰æ ¼å¼å›¾ç‰‡è¿›è¡Œå‹ç¼©"><meta property="og:description" content="åŸç”Ÿ PHP å¯¹ PNGã€JPGã€JPEGã€GIFã€WebP ç­‰å¸¸ç”¨å›¾ç‰‡æ ¼å¼è¿›è¡Œå‹ç¼©ï¼Œæ— ç¬¬ä¸‰æ–¹æ‰©å±•ä¾èµ–ï¼Œä»…éœ€ç®€å•é…ç½®å³å¯ä½¿ç”¨ï¼Œæ”¯æŒ PNG é€æ˜èƒŒæ™¯ã€‚"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-24T14:52:13+08:00"><meta property="article:modified_time" content="2024-09-24T14:52:13+08:00"><meta property="article:tag" content="PHP"><meta property="article:tag" content="å›¾ç‰‡å‹ç¼©"><meta property="og:image" content="https://sqrt-cat.github.io/img/og-images-1.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sqrt-cat.github.io/img/og-images-1.jpg"><meta name=twitter:title content="PHP å¯¹ PNGã€JPGã€JPEGã€GIFã€WebP ç­‰æ ¼å¼å›¾ç‰‡è¿›è¡Œå‹ç¼©"><meta name=twitter:description content="åŸç”Ÿ PHP å¯¹ PNGã€JPGã€JPEGã€GIFã€WebP ç­‰å¸¸ç”¨å›¾ç‰‡æ ¼å¼è¿›è¡Œå‹ç¼©ï¼Œæ— ç¬¬ä¸‰æ–¹æ‰©å±•ä¾èµ–ï¼Œä»…éœ€ç®€å•é…ç½®å³å¯ä½¿ç”¨ï¼Œæ”¯æŒ PNG é€æ˜èƒŒæ™¯ã€‚"><meta name=generator content="Hugo 0.131.0"><link rel=stylesheet href=/css/output.css><style></style><link rel=stylesheet data-custom-syntax-highlighting><style>.chroma{padding:1em;background-color:var(--dream-pre-bg,#f5f5f5);border-radius:.5em;overflow:auto}html.dark .chroma{background-color:var(--dream-pre-bg-dark,#262626)}</style><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/css/APlayer.min.css><script defer src=/js/alpinejs@3.x.x.min.js></script></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav x-data="{ isSticky: false }" x-init="window.addEventListener('scroll', () => { isSticky = window.scrollY > 30 })" class="sticky top-0 z-30 mt-4 lg:mt-8 py-4" :class="{ 'bg-base-100 shadow-lg dark:border-b dark:border-base-content/30': isSticky }"><div class="container flex justify-between px-4"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:online" @click="flip = !flip" title="Flip it!"><div class="h-10 rounded-full"><img src=/img/author.jpg alt="sqrtcat çš„åšå®¢"></div></div><div><a href=https://sqrt-cat.github.io/ class="text-lg font-semibold cursor-pointer">sqrtcat çš„åšå®¢</a><div class="text-base-content/60 text-sm">é«˜çº§äº‘ç¨‹åºå‘˜ã€‚</div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-md"><li><div role=link tabindex=0 class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title=About><ion-icon name=information-circle></ion-icon>About</div></li><li><a class="group inline-flex items-center p-2 cursor-pointer" href=/search title=Search><ion-icon name=search></ion-icon>Search</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/index.xml title=RSS><ion-icon name=logo-rss></ion-icon>RSS</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=Archives><ion-icon name=archive></ion-icon>Archives</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/categories title="All Categories"><ion-icon name=grid></ion-icon>All Categories</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title="All Tags"><ion-icon name=pricetags></ion-icon>All Tags</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><div role=link tabindex=0 class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title=About>About</div><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/search title=Search><ion-icon class=group-hover:text-primary-content name=search></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/index.xml title=RSS><ion-icon class=group-hover:text-primary-content name=logo-rss></ion-icon></a><div class="dropdown dropdown-end dropdown-hover"><div tabindex=0 role=button class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" aria-label="Select an option"><ion-icon class="group-hover:text-primary-content text-xl" name=menu></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-xl"><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=Archives><ion-icon name=archive></ion-icon>Archives</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/categories title="All Categories"><ion-icon name=grid></ion-icon>All Categories</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title="All Tags"><ion-icon name=pricetags></ion-icon>All Tags</a></li></ul></div></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="mt-4 px-4"><div class=relative x-data="{ height: '' }" x-init="height = $el.scrollHeight + 'px'"><div class="absolute right-0 lg:w-36 xl:w-48 hidden lg:block" :style="{ height }"><nav id=TableOfContents></nav></div><article class="mx-auto prose dark:prose-invert" id=dream-single-post-main><header><h1>PHP å¯¹ PNGã€JPGã€JPEGã€GIFã€WebP ç­‰æ ¼å¼å›¾ç‰‡è¿›è¡Œå‹ç¼©</h1><p class=text-sm><span data-format=luxon>2024-09-24T14:52:13+08:00</span>
| <span>2 minutes read</span>
| <span>Update at
<span data-format=luxon>2024-09-24T14:52:13+08:00</span></span></p><div class="flex justify-between"><div class="flex items-center"><span>@</span>
<span>sqrtcat</span></div><span class="flex items-center gap-2"><a class="group inline-flex items-center p-2 text-sm rounded-full cursor-pointer hover:bg-primary" href="https://twitter.com/intent/tweet?text=PHP%20%e5%af%b9%20PNG%e3%80%81JPG%e3%80%81JPEG%e3%80%81GIF%e3%80%81WebP%20%e7%ad%89%e6%a0%bc%e5%bc%8f%e5%9b%be%e7%89%87%e8%bf%9b%e8%a1%8c%e5%8e%8b%e7%bc%a9&url=https%3a%2f%2fsqrt-cat.github.io%2fposts%2fphp%2fimage-compress%2f" title="Share on X"><ion-icon class=group-hover:text-primary-content name=logo-x></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsqrt-cat.github.io%2fposts%2fphp%2fimage-compress%2f" title="Share on Facebook"><ion-icon class=group-hover:text-primary-content name=logo-facebook></ion-icon></a></span></div></header><p>åŸç”Ÿ PHP å¯¹ PNGã€JPGã€JPEGã€GIFã€WebP ç­‰å¸¸ç”¨å›¾ç‰‡æ ¼å¼è¿›è¡Œå‹ç¼©ï¼Œæ— ç¬¬ä¸‰æ–¹æ‰©å±•ä¾èµ–ï¼Œä»…éœ€ç®€å•é…ç½®å³å¯ä½¿ç”¨ï¼Œæ”¯æŒ PNG é€æ˜èƒŒæ™¯ã€‚</p><p>æ”¯æŒè¦†ç›–æºæ–‡ä»¶æˆ–å¦è¡Œç”Ÿæˆæ–°æ–‡ä»¶ï¼ˆè¾“å‡ºè‡³ä¸è¾“å…¥ç›®å½•åŒçº§ ./output æ–‡ä»¶å¤¹ä¸‹ï¼‰ã€‚</p><p>å°†è„šæœ¬ä¿å­˜è‡³å¾…å¤„ç†å›¾ç‰‡ç›®å½•çš„åŒçº§å³å¯ï¼Œå¹¶å°† $input_dir ä¿®æ”¹ä¸ºå¾…å¤„ç†å›¾ç‰‡ç›®å½•çš„è·¯å¾„ï¼ˆphp image_compress.phpï¼‰ã€‚</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>ini_set</span><span class=p>(</span><span class=s1>&#39;memory_limit&#39;</span><span class=p>,</span> <span class=s1>&#39;512M&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å¾…å¤„ç†å›¾ç‰‡ç›®å½•
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$input_dir</span> <span class=o>=</span> <span class=s1>&#39;./input&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// å‹ç¼©é‡‡æ ·ç‡ 0.7 è¡¨ç¤ºå‹ç¼©ç‡ä¸º 70%
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=no>COMPRESS_RATE</span> <span class=o>=</span> <span class=mf>0.7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ˜¯å¦è¦†å†™æºæ–‡ä»¶ false çš„è¯ä¼šç”Ÿæˆæ–°çš„æ–‡ä»¶å°†ä¼šå­˜å‚¨åœ¨
</span></span></span><span class=line><span class=cl><span class=c1>// $input_dir åŒçº§çš„ ./output æ–‡ä»¶å¤¹ä¸‹
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>const</span> <span class=no>OVER_WRITE_SRC</span> <span class=o>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>compressImg</span><span class=p>(</span><span class=nv>$input_dir</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd> * é€’å½’éå† folder_path ç›®å½•ä¸‹çš„æ‰€æœ‰çš„å›¾ç‰‡æ–‡ä»¶å¹¶å‹ç¼©
</span></span></span><span class=line><span class=cl><span class=sd> * @param $folder_path
</span></span></span><span class=line><span class=cl><span class=sd> */</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>compressImg</span><span class=p>(</span><span class=nv>$folder_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// $folder_path = realpath($folder_path);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$handle</span> <span class=o>=</span> <span class=nx>opendir</span><span class=p>(</span><span class=nv>$folder_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=p>(</span><span class=k>false</span> <span class=o>!==</span> <span class=p>(</span><span class=nv>$file</span> <span class=o>=</span> <span class=nx>readdir</span><span class=p>(</span><span class=nv>$handle</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$file</span> <span class=o>!=</span> <span class=s1>&#39;.&#39;</span> <span class=o>&amp;&amp;</span> <span class=nv>$file</span> <span class=o>!=</span> <span class=s1>&#39;..&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$file_path</span> <span class=o>=</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s1>&#39;.//&#39;</span><span class=p>,</span> <span class=s1>&#39;./&#39;</span><span class=p>,</span> <span class=nv>$folder_path</span><span class=o>.</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=nx>is_dir</span><span class=p>(</span><span class=nv>$file_path</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>compressImg</span><span class=p>(</span><span class=nv>$file_path</span><span class=p>);</span> <span class=c1>// é€’å½’éå†å­æ–‡ä»¶å¤¹
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$ext</span> <span class=o>=</span> <span class=nx>explode</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>,</span> <span class=nx>mime_content_type</span><span class=p>(</span><span class=nv>$file_path</span><span class=p>))[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>echo</span> <span class=nv>$file_path</span><span class=o>.</span><span class=s1>&#39; - &#39;</span><span class=o>.</span><span class=nv>$ext</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span> <span class=c1>// å¤„ç†æ–‡ä»¶æ“ä½œ
</span></span></span><span class=line><span class=cl><span class=c1></span>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$ext</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;png&#39;</span><span class=p>,</span> <span class=s1>&#39;jpg&#39;</span><span class=p>,</span> <span class=s1>&#39;jpeg&#39;</span><span class=p>,</span> <span class=s1>&#39;gif&#39;</span><span class=p>,</span> <span class=s1>&#39;webp&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>list</span><span class=p>(</span><span class=nv>$width</span><span class=p>,</span> <span class=nv>$height</span><span class=p>)</span> <span class=o>=</span> <span class=nx>getimagesize</span><span class=p>(</span><span class=nv>$file_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=k>empty</span><span class=p>(</span><span class=nv>$width</span><span class=p>)</span> <span class=o>||</span> <span class=k>empty</span><span class=p>(</span><span class=nv>$height</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>switch</span> <span class=p>(</span><span class=nv>$ext</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>case</span> <span class=s1>&#39;png&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                        <span class=nv>$img</span> <span class=o>=</span> <span class=nx>imagecreatefrompng</span><span class=p>(</span><span class=nv>$file_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>case</span> <span class=s1>&#39;jpg&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>case</span> <span class=s1>&#39;jpeg&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                        <span class=nv>$img</span> <span class=o>=</span> <span class=nx>imagecreatefromjpeg</span><span class=p>(</span><span class=nv>$file_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>case</span> <span class=s1>&#39;gif&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                        <span class=nv>$img</span> <span class=o>=</span> <span class=nx>imagecreatefromgif</span><span class=p>(</span><span class=nv>$file_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>case</span> <span class=s1>&#39;webp&#39;</span><span class=o>:</span>
</span></span><span class=line><span class=cl>                        <span class=nv>$img</span> <span class=o>=</span> <span class=nx>imagecreatefromwebp</span><span class=p>(</span><span class=nv>$file_path</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=k>empty</span><span class=p>(</span><span class=nv>$img</span><span class=p>)</span> <span class=o>||</span> <span class=o>!</span><span class=nx>is_resource</span><span class=p>(</span><span class=nv>$img</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nv>$n_w</span> <span class=o>=</span> <span class=nv>$width</span> <span class=o>*</span> <span class=nx>COMPRESS_RATE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nv>$n_h</span> <span class=o>=</span> <span class=nv>$height</span> <span class=o>*</span> <span class=nx>COMPRESS_RATE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=nv>$new</span> <span class=o>=</span> <span class=nx>imagecreatetruecolor</span><span class=p>(</span><span class=nv>$n_w</span><span class=p>,</span> <span class=nv>$n_h</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// ä¿æŒpngçš„é€æ˜èƒŒæ™¯
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>if</span> <span class=p>(</span><span class=nv>$ext</span> <span class=o>==</span> <span class=s1>&#39;png&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$transparent</span> <span class=o>=</span> <span class=nx>imagecolorallocatealpha</span><span class=p>(</span><span class=nv>$new</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>127</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>imagefill</span><span class=p>(</span><span class=nv>$new</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nv>$transparent</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>imagealphablending</span><span class=p>(</span><span class=nv>$new</span><span class=p>,</span> <span class=k>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=nx>imagesavealpha</span><span class=p>(</span><span class=nv>$new</span><span class=p>,</span> <span class=k>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1>// imagecopyresampled($new, $img, 0, 0, 0, 0, $width, $height, $width, $height);
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=nx>imagecopyresampled</span><span class=p>(</span><span class=nv>$new</span><span class=p>,</span> <span class=nv>$img</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=nv>$n_w</span><span class=p>,</span> <span class=nv>$n_h</span><span class=p>,</span> <span class=nv>$width</span><span class=p>,</span> <span class=nv>$height</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1>//æ‹·è´éƒ¨åˆ†å›¾åƒå¹¶è°ƒæ•´
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>// imagecopyresized($new, $img, 0, 0, 0, 0, $n_w, $n_h, $width, $height);
</span></span></span><span class=line><span class=cl><span class=c1></span>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>OVER_WRITE_SRC</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$saveDir</span> <span class=o>=</span> <span class=s1>&#39;./output/&#39;</span><span class=o>.</span><span class=nv>$folder_path</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>is_dir</span><span class=p>(</span><span class=nv>$saveDir</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=nx>mkdir</span><span class=p>(</span><span class=nv>$saveDir</span><span class=p>,</span> <span class=mo>0777</span><span class=p>,</span> <span class=k>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$savePath</span> <span class=o>=</span> <span class=s1>&#39;./output/&#39;</span><span class=o>.</span><span class=nx>str_replace</span><span class=p>(</span><span class=s2>&#34;./&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=nv>$folder_path</span><span class=o>.</span><span class=s1>&#39;/&#39;</span><span class=o>.</span><span class=nv>$file</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>//è¦†ç›–æºæ–‡ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span>                    <span class=nv>$savePath</span> <span class=o>=</span> <span class=nv>$file_path</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nv>$ext</span> <span class=o>==</span> <span class=s1>&#39;png&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>imagepng</span><span class=p>(</span><span class=nv>$new</span><span class=p>,</span> <span class=nv>$savePath</span><span class=p>,</span> <span class=mi>9</span><span class=p>);</span> <span class=c1>//0-9 å€¼è¶Šå¤§å‹ç¼©ç‡è¶Šé«˜
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>imagejpeg</span><span class=p>(</span><span class=nv>$new</span><span class=p>,</span> <span class=nv>$savePath</span><span class=p>,</span> <span class=mi>75</span><span class=p>);</span> <span class=c1>//0-100 é»˜è®¤ 75
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=nx>imagedestroy</span><span class=p>(</span><span class=nv>$new</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>imagedestroy</span><span class=p>(</span><span class=nv>$img</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nx>closedir</span><span class=p>(</span><span class=nv>$handle</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=divider></div><div class="flex flex-col md:flex-row justify-between gap-4 py-4"><div></div><a class="group btn btn-outline" href=/posts/ops/rsync/ title="Rsync å‘½ä»¤çš„ä½¿ç”¨è¯¦è§£"><div class="inline-flex flex-col items-end"><span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">Next page</span>
<span class="max-w-48 truncate">Rsync å‘½ä»¤çš„ä½¿ç”¨è¯¦è§£</span></div><ion-icon name=chevron-forward></ion-icon></a></div></article></div><div class="divider max-w-[65ch] mx-auto"></div><section class="max-w-[65ch] mx-auto space-y-4"><template x-if="['localhost', '127.0.0.1'].indexOf(window.location.hostname) == -1"><article><script src=https://utteranc.es/client.js repo=sqrt-cat/sqrt-cat.github.io issue-term=og:title theme=github-light crossorigin=anonymous async></script></article></template></section></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2024 sqrtcat çš„åšå®¢</p><p><p class=text-sm>ğŸŒ± <span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>sqrtcat</a></p></p></div><div x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center h-[32px] px-2 gap-2 border border-base-300 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class=dream-grid><div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column"><article class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"><div class=card-body><div class=card-title>å…³äºæˆ‘</div><div class="prose dark:prose-invert"><p>èµ„æ·±äº‘ç¨‹åºå‘˜ï¼Œåœ¨çº¿æ”¯æŒæŠ€æœ¯çš„è®¨è®ºã€æ”»åšã€æ¶æ„ç­‰é«˜çº§è¯é¢˜ï¼Œçº¿ä¸‹æš‚æä¾›åˆçº§æŠ€æœ¯æ”¯æŒã€‚
åœ¨çº¿æ¥å•ï¼šApp / å°ç¨‹åº / WordPress / å•†åŸ / é¢„çº¦ / ä¼ä¸šç«™ / å¤–è´¸ç«™ / MESç³»ç»Ÿ / SEOä¼˜åŒ–</p><p>wx: bigcat582</p><img src=/img/qrcode.png></div></div></article></div><div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column"><article class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"><div class=card-body><div class=card-title>Search</div><div class="prose dark:prose-invert"><p>å¦‚ä½•å¼€å¯æ£€ç´¢åŠŸèƒ½ï¼Œåªéœ€åˆ›å»º search æ–‡æ¡£å³å¯ã€‚</p><blockquote><p>hugo new search/_index.md</p></blockquote></div></div></article></div><div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column"><article class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"><div class=card-body><div class=card-title>Social Links</div><ul class="menu menu-horizontal flex-wrap w-full [&_ion-icon]:text-lg"><li><a href=mailto:sqrtcat@gmail.com title=Email><ion-icon name=mail></ion-icon>sqrtcat@gmail.com</a></li><li><a href=https://blog.20230611.cn/ target=_blank title=å¤§ä½¬é«˜çš„åšå®¢><ion-icon name=globe-outline></ion-icon>å¤§ä½¬é«˜çš„åšå®¢</a></li><li><a href=https://www.php20.cn/ target=_blank title=ä»™å£«å¯åšå®¢><ion-icon name=globe-outline></ion-icon>ä»™å£«å¯åšå®¢</a></li></ul></div></article></div></div></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest",window.hasTwitterEmbed=null,window.hasTwitterEmbed&&(window.twttr=function(e,t,n){var o,i=e.getElementsByTagName(t)[0],s=window.twttr||{};return e.getElementById(n)?s:(o=e.createElement(t),o.id=n,o.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(o,i),s._e=[],s.ready=function(e){s._e.push(e)},s)}(document,"script","twitter-wjs"))</script><script src=/js/imagesloaded.pkgd.min.js crossorigin=anonymous></script><script src=/js/masonry.pkgd.min.js crossorigin=anonymous></script><script src=/js/grid.js></script><script src=/js/main.js></script><script src=/js/luxon@1.26.0.js integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=" crossorigin=anonymous></script><script>format();function format(){document.querySelectorAll('span[data-format="luxon"]').forEach(e=>{const t=e.textContent;e.textContent=luxon.DateTime.fromISO(t,{locale:"en"}).toFormat("yyyyå¹´MMæœˆddæ—¥")})}</script><script>window.customSyntaxHighlighting={light:"/css/syntax-light.min.css",dark:"/css/syntax-dark.min.css"},document.addEventListener("alpine:initialized",()=>{var e=Alpine.store("darkMode").isDark(),t=e?window.customSyntaxHighlighting.dark:window.customSyntaxHighlighting.light;document.querySelector("link[data-custom-syntax-highlighting]").setAttribute("href",t)})</script><script src=/js/custom.js></script><script src=/js/APlayer.min.js></script><script src=/js/meting@2.0.1.min.js></script><script type=module src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js></script><script nomodule src=https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js></script></body></html>